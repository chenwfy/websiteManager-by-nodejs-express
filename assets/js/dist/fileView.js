!function(e){var i,o,n,l,a,t,r,s,p,c=window.top.UploadRoot,d="pending";e(function(){return i=e.queryString().root||c,o=e.queryString().fileType||"All",i.StartWith(c)?(e("#li_dirName").html("\u5f53\u524d\u76ee\u5f55\uff1a"+i),l=e("#div_uploaderLayer").hide(),a=e("#div_queueWrapper"),s(),t(),void r()):void e.Alert("\u62b1\u6b49\uff0c\u53ea\u80fd\u9009\u62e9\u201c"+c+"\u201d\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff01")}),t=function(){var t=fileTypeFilter.filterOptions[o];!t&&(t=fileTypeFilter.filterOptions.All),n=WebUploader.create({auto:!1,resize:!1,swf:"/assets/js/lib/Uploader.swf",server:"/service/fileView/uploadFile",accept:{title:t.title,extensions:t.extensions.replace(/\|/g,","),mimeTypes:t.mimeTypes},formData:{root:i,filter:o},disableGlobalDnd:!0,fileNumLimit:10,fileSizeLimit:209715200,fileSingleSizeLimit:20971520,pick:{id:"#fliePicker",innerHTML:'<i class="icon-Awesome-plus-circle"></i>&nbsp;\u9009\u62e9\u6587\u4ef6'}}),n.on("beforeFileQueued",function(i){var n=new fileTypeFilter.filter(o),l=n.allowable(i.name);return!l&&e.Alert("\u62b1\u6b49\uff0c\u6587\u4ef6 \u201c "+i.name+" \u201d \u7c7b\u578b\u4e0d\u88ab\u652f\u6301\uff01"),l}),n.on("fileQueued",function(i){var o=e("<p>").attr({id:"p_"+i.id});e("<label>").addClass("name").html(i.name).appendTo(o),e("<label>").addClass("info").html("\u7b49\u5f85\u4e0a\u4f20").appendTo(o),e("<i>").addClass("icon-Awesome-remove").on("click",function(){n.cancelFile(i),n.removeFile(i,!0),o.remove()}).appendTo(o),e("<span>").appendTo(o),o.appendTo(a)}),n.on("uploadProgress",function(e,i){var o=a.find("p#p_"+e.id).eq(0);o&&o.length>0&&(o.find("label.info").removeClass("error").html("\u4e0a\u4f20\u4e2d\u2026\u2026\uff01"),o.find("span").css("width",100*i+"%"))}),n.on("uploadSuccess",function(e){var i=a.find("p#p_"+e.id).eq(0);i&&i.length>0&&i.remove()}),n.on("uploadError",function(e,i){var o=a.find("p#p_"+e.id).eq(0);o&&o.length>0&&o.find("label.info").addClass("error").html("\u4e0a\u4f20\u51fa\u9519\uff01"),console.log(i)}),n.on("uploadComplete",function(e){var i=a.find("p#p_"+e.id).eq(0);i&&i.length>0&&i.find("label.info").removeClass("error").html("\u4e0a\u4f20\u5b8c\u6210\uff01")}),n.on("all",function(i){"startUpload"===i?d="uploading":"stopUpload"===i?d="paused":"uploadFinished"===i&&(d="done",window.setTimeout(function(){e.Alert("\u4e0a\u4f20\u5b8c\u6210\uff0c\u5171\u6210\u529f\u4e0a\u4f20 "+n.getStats().successNum+" \u4e2a\u6587\u4ef6!"),n.reset(),a.children().remove(),l.hide(),s()},50))})},r=function(){e("#btn_upload").on("click",function(){l.show()}),e("#btn_refresh").on("click",function(){s()}),e("#btn_cancelUpload").on("click",function(){n&&n.isInProgress()&&n.stop(!0),a.children().remove(),l.hide(),s()}),e("#btn_startUpload").on("click",function(){n&&n.getFiles().length>0&&n.upload()})},s=function(){var n=e("#ul_listWrapper"),l=n.find("li.loading"),a='<li class="nofile">\u5f53\u524d\u76ee\u5f55\u6ca1\u6709\u6587\u4ef6!</li>';n.children().not(l).remove()&&l.show(),e.ajaxPost("/service/fileView/readDir",{root:i,filter:o},function(o){var t=o.data,r=t.length,s=new fileTypeFilter.filter("Images");0==r&&e(a).appendTo(n),r>0&&e.each(t,function(o,t){!function(o,t){var r=p(t),c=e("<li>"),d=e("<a>").attr({href:"javascript:void(0);"}).append('<i class="'+r+'"></i>',t).on("click",function(){var e=(i+"/"+t).replace(/\/\//g,"/");window.frameElement.callback(e),window.top.dialog.close()}),f=e("<p>").append(e("<i>").addClass("icon-Awesome-remove").on("click",function(){e.Confirm("\u786e\u8ba4\u8981\u5220\u9664\u6587\u4ef6\uff1a "+t+" \u5417\uff1f",{buttonOkClicked:function(){e.ajaxPost("/service/fileView/removeFile",{root:i,file:encodeURIComponent(t)},function(){c.remove(),0==n.children().not(l).length&&e(a).appendTo(n)})}})}));s.allowable(t)&&d.picurePreview((i+"/"+t).replace(/\/\//g,"/")),l.before(c.append(d,f))}(o,t)}),l.hide()})},p=function(e){var i,o={"icon-Awesome-file-photo-o":[".jpg",".jpeg",".png",".gif",".bmp",".svg"],"icon-Awesome-file-sound-o":[".mid",".mp3",".wav",".wma","m4a",".mp4a",".flc",".aac",".ogg"],"icon-Awesome-file-movie-o":[".wmv",".rm",".rmvb",".avi",".mp4",".mpeg"],"icon-Awesome-file-word-o":[".doc",".docx"],"icon-Awesome-file-excel-o":[".xls",".xlsx"],"icon-Awesome-file-powerpoint-o":[".ppt",".pptx"],"icon-Awesome-file-pdf-o":[".pdf"],"icon-Awesome-file-zip-o":[".zip",".7z",".rar"],"icon-Awesome-file-code-o":[".html",".htm",".cs",".css",".js",".json",".java",".m",".h",".cpp",".aspx",".ashx",".php",".config",".xml"],"icon-Awesome-flash":[".fla",".swf",".flv"],"icon-Awesome-umbrella":[".exe"]},n="icon-Awesome-file-o",l=e.substring(e.lastIndexOf(".")).toLowerCase();if(l)for(i in o)if(o[i].indexOf(l)>=0)return i;return n}}($);