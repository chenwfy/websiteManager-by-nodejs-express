!function(a,e){"use strict";if("function"==typeof define&&define.amd)define(["jquery","exports"],function(n,t){a.datePicker=e(t,n)});else if("undefined"!=typeof exports){var n=require("jquery");e(exports,n)}else a.datePicker=e(a,"undefined"!=typeof jQuery?jQuery:window.Zepto)}("undefined"!=typeof window?window:this,function(a,e){"use strict";var n=function(a,e){a.event?a.event.cancelBubble=!0:e.stopPropagation()},t=function(){var a,t,i,o,d,r,l,c,m,p,h,u,f,y,v,w,C,x,k=arguments[0]||{},Y=arguments[1]||window,D=arguments[2]||window.event,T=new Date;if(!k.elment)throw'datePicker error: please specify " options.elment " as a JQuery object';if(a=function(a){if(a){var e=a[0].tagName.toLowerCase();return["input","textarea"].indexOf(e)>=0?a.val():a.text()}return""},t=function(a,e){if(a){var n=a[0].tagName.toLowerCase(),t=["input","textarea"].indexOf(n)>=0;e=e||"",t&&a.val(e),!t&&a.text(e)}},i=function(e,n,t){var s=n,i="string"==typeof e?e:a(e);return i.IsDate()&&(i+=t),i.IsDateTime()&&(s=i),s.ConvertToDateTime()},o=function(a,n){var t=313,s=263,i=a.getOffset(n),o=a.outerHeight(),d=e(window).width(),r=e(window).height(),l=i.top+o+4,c=i.left,m=i.top,p=r-l;return t>p&&m>=t&&(l=m-t),c+s>d&&(c=d-s,0>=c&&(c=0)),{left:c,top:l}},d=function(a){a&&a.fadeOut(200,function(){a.children().remove()})},r=function(a){e(document).on("click",function(){d(a)}),window.top.FWK.LeftFrameWindow()&&e(window.top.FWK.LeftFrameWindow().document).on("click",function(){d(a)}),window.top.FWK.MainFrameWindow()&&e(window.top.FWK.MainFrameWindow().document).on("click",function(){d(a)}),window.top.dialog&&window.top.dialog.dialogWindow()&&e(window.top.dialog.dialogWindow().document).on("click",function(){d(a)})},l=k.elment,c=k.model||"picker",m=i(k.rangeMin,"1900-1-1 0:0:0"," 0:0:0"),p=i(k.rangeMax,"2099-12-31 23:59:59"," 23:59:59"),h=i(l,T.Format("yyyy-MM-dd HH:mm:ss"),T.Format(" HH:mm:ss")),u=k.format||"yyyy-MM-dd HH:mm:ss",f=k.pickHandler||null,m>=p)throw"datePicker error: date ranage error\uff01";m>h&&(h=m),h>p&&(h=p),y=null,v=function(){d(y)},w=function(a){v&&v(),t(l,a),f&&f(a)},"render"==c&&(y=l,v=null,w=f),"picker"==c&&(n(Y,D),y=e("#DatePicker_Layer"),y&&y.length>0?y.children().remove().hide():(y=e("<div>").addClass("dp-layer").attr({id:"DatePicker_Layer"}).on("click",function(a){n(Y,a)}).appendTo(document.body),r(y)),C=o(l,Y),y.css({left:C.left+"px",top:C.top+"px"}).fadeIn(200)),x={render:y,minDate:m,maxDate:p,currentDate:h,format:u,pickedHandler:w,closerHandler:v,showButtons:"picker"==c},new s(x)},s=function(a){var t,s=a.render,i=a.minDate,o=a.maxDate,d=a.currentDate,r=a.format,l=a.pickedHandler,c=a.closerHandler,m=a.showButtons,p=i.DateTimeToJson(),h=o.DateTimeToJson(),u=d.DateTimeToJson(),f={year:u.Year,month:u.Month,day:u.Day,hour:u.Hour,minute:u.Minute,second:u.Second},y=[42],v=function(){t=e("<div>").addClass("dp-wrapper").on("click",function(a){e(".ym-layer, .time-layer").hide()}),w(),C(),x(),k(),D(),t.appendTo(s)},w=function(){var a,s,i,o,d,r,l,c,m=new Date(p.Year,p.Month-1,1),y=new Date(h.Year,h.Month-1,1),v=new Date(u.Year,u.Month-1,1),w=function(a,n,t,s,c){var u,v;for(a.children().remove(),n<=p.Year&&s.addClass("up-dis"),t>=h.Year&&c.addClass("down-dis"),u="",v=n;t>=v;v++)!function(n){u="",(n<p.Year||n>h.Year)&&(u="dis"),n==f.year&&(u="active"),e("<label>").addClass(u).html(n+"\u5e74").on("click",function(){if(!e(this).hasClass("dis")){n<=p.Year&&C.addClass("prev-dis"),n>p.Year&&C.removeClass("prev-dis"),n>=h.year&&o.addClass("next-dis"),n<h.year&&o.removeClass("next-dis"),f.year=n,i.html(n+"\u5e74");var a=new Date(f.year,f.month-1,1);m>a&&(f.month=p.Month,r.html(f.month+"\u6708"),d.addClass("prev-dis")),a>=y&&(f.month=h.Month,r.html(f.month+"\u6708"),l.addClass("next-dis")),T(f.year,f.month)}}).appendTo(a)}(v)},C=e("<span>").addClass("prev").on("click",function(){e(this).hasClass("prev-dis")||(f.year--,o.hasClass("next-dis")&&f.year<h.Year&&o.removeClass("next-dis"),f.year<=p.Year&&e(this).addClass("prev-dis"),i.html(f.year+"\u5e74"),new Date(f.year,f.month-1,1)<=m&&(f.month=p.Month,r.html(f.month+"\u6708"),d.addClass("prev-dis")),T(f.year,f.month))});u.Year<=p.Year&&C.addClass("prev-dis"),i=e("<p>").html(u.Year+"\u5e74").on("click",function(t){n(window,t),e(this).attr({"data-minYear":f.year-3,"data-maxYear":f.year+4});var s,o,d,r=a.find(".ym-layer");r&&r.length>0?(s=r.find("span.up").removeClass("up-dis"),d=r.find("p").eq(0),o=r.find("span.down").removeClass("down-dis")):(r=e("<div>").addClass("ym-layer").appendTo(a),s=e("<span>").addClass("up").on("click",function(a){var t,s;n(window,a),e(this).hasClass("up-dis")||(t=parseInt(i.attr("data-minYear"),10)-8,s=parseInt(i.attr("data-maxYear"),10)-8,i.attr({"data-minYear":t,"data-maxYear":s}),w(d,t,s,e(this),o))}).appendTo(r),d=e("<p>").appendTo(r),o=e("<span>").addClass("down").on("click",function(a){var t,o;n(window,a),e(this).hasClass("down-dis")||(t=parseInt(i.attr("data-minYear"),10)+8,o=parseInt(i.attr("data-maxYear"),10)+8,i.attr({"data-minYear":t,"data-maxYear":o}),w(d,t,o,s,e(this)))}).appendTo(r)),r.show(),window.setTimeout(function(){w(d,parseInt(i.attr("data-minYear"),10),parseInt(i.attr("data-maxYear"),10),s,o)},10)}),o=e("<span>").addClass("next").on("click",function(){e(this).hasClass("next-dis")||(f.year++,C.hasClass("prev-dis")&&f.year>p.Year&&C.removeClass("prev-dis"),f.year>=h.Year&&e(this).addClass("next-dis"),i.html(f.year+"\u5e74"),new Date(f.year,f.month-1,1)>=y&&(f.month=h.Month,r.html(f.month+"\u6708"),l.addClass("next-dis")),T(f.year,f.month))}),u.Year>=h.Year&&o.addClass("next-dis"),d=e("<span>").addClass("prev").on("click",function(){e(this).hasClass("prev-dis")||(1==f.month?(f.month=12,f.year--,o.hasClass("next-dis")&&f.year<h.Year&&o.removeClass("next-dis"),f.year<=p.Year&&C.addClass("prev-dis"),i.html(f.year+"\u5e74")):f.month--,c=new Date(f.year,f.month-1,1),l.hasClass("next-dis")&&y>c&&l.removeClass("next-dis"),m>=c&&e(this).addClass("prev-dis"),r.html(f.month+"\u6708"),T(f.year,f.month))}),m>=v&&d.addClass("prev-dis"),r=e("<p>").html(u.Month+"\u6708").on("click",function(a){var t,i,o,p;for(n(window,a),t=s.find(".ym-layer"),o="",!(t&&t.length>0)&&(t=e("<div>").addClass("ym-layer").appendTo(s)),t.children().remove().hide(),i=e("<p>").appendTo(t),p=1;12>=p;p++)!function(a){o="",c=new Date(f.year,a-1,1),(m>c||c>y)&&(o="dis"),a==f.month&&(o="active"),e("<label>").addClass(o).html(a+"\u6708").on("click",function(){e(this).hasClass("dis")||(m>=c&&d.addClass("prev-dis"),c>m&&d.removeClass("prev-dis"),c>=y&&l.addClass("next-dis"),y>c&&l.removeClass("next-dis"),f.month=a,r.html(f.month+"\u6708"),T(f.year,f.month))}).appendTo(i)}(p);t.show()}),l=e("<span>").addClass("next").on("click",function(){e(this).hasClass("next-dis")||(12==f.month?(f.month=1,f.year++,C.hasClass("prev-dis")&&f.year>p.Year&&C.removeClass("prev-dis"),f.year>=h.Year&&o.addClass("next-dis"),i.html(f.year+"\u5e74")):f.month++,c=new Date(f.year,f.month-1,1),d.hasClass("prev-dis")&&c>m&&d.removeClass("prev-dis"),c>=y&&e(this).addClass("next-dis"),r.html(f.month+"\u6708"),T(f.year,f.month))}),v>=y&&l.addClass("next-dis"),a=e("<li>").addClass("year").append(C,i,o),s=e("<li>").addClass("month").append(d,r,l),e("<ul>").addClass("year-month").append(a,s).appendTo(t)},C=function(){t.append('<ul class="week"><li>\u65e5</li><li>\u4e00</li><li>\u4e8c</li><li>\u4e09</li><li>\u56db</li><li>\u4e94</li><li>\u516d</li></ul>')},x=function(){var a,n,s=e("<ul>").addClass("day");for(a=0;41>=a;a++)n=e("<li>").on("click",function(){if(!e(this).hasClass("dis")&&e(this).attr("data-year")&&e(this).attr("data-month")){var a=~~parseInt(e(this).attr("data-year"),10),n=~~parseInt(e(this).attr("data-month"),10),t=~~parseInt(e(this).text(),10);a>0&&n>0&&t>0&&(f.year=a,f.month=n,f.day=t,g())}}).appendTo(s),y[a]=n;s.appendTo(t)},k=function(){var a,n=e("<label>").html(u.Hour).on("click",function(n){Y(n,a,e(this),"hour",0,23)}),s=e("<label>").html(u.Minute).on("click",function(n){Y(n,a,e(this),"minute",0,59)}),i=e("<label>").html(u.Second).on("click",function(n){Y(n,a,e(this),"second",0,59)});a=e("<li>").addClass("timer").append(n,'<label class="short">\uff1a</label>',s,'<label class="short">\uff1a</label>',i),e("<ul>").addClass("time").append('<li class="txt">\u5f53\u524d\u65f6\u95f4\uff1a</li>',a).appendTo(t)},Y=function(a,t,s,i,o,d){var r,l,c;for(n(window,a),r=t.find(".time-layer"),l="",!(r&&r.length>0)&&(r=e("<div>").addClass("time-layer").appendTo(t)),r.children().remove().hide(),c=o;d>=c;c++)!function(a){l=a==f[i]?"active":"",e("<span>").addClass(l).html(a).on("click",function(){e(this).hasClass("dis")||(s.html(a),f[i]=a)}).appendTo(r)}(c);r.show()},D=function(){if(m){var a=e("<li>");e('<input type="button" name="btn_01" id="btn_01" value="\u53d6\u6d88">').on("click",function(){c&&c()}).appendTo(a),e('<input type="button" name="btn_02" id="btn_02" value="\u6e05\u7a7a">').on("click",function(){M("")}).appendTo(a),e('<input type="button" name="btn_03" id="btn_03" value="\u4eca\u5929">').on("click",function(){M((new Date).Format(r))}).appendTo(a),e('<input type="button" name="btn_04" id="btn_04" value="\u786e\u5b9a">').on("click",function(){g()}).appendTo(a),e("<ul>").addClass("button").append(a).appendTo(t)}},T=function(a,e){var n,t,s,d,r=1>=e?a-1:a,l=1>=e?12:e-1,c=b(r,l),m=b(a,e),p=new Date(a,e-1,1).getDay(),h=e>=12?a+1:a,v=e>=12?1:e+1,w=[42];for(n=p;n>=0;n--)w[n]={year:r,month:l,day:c-(p-n),className:"attach"};for(n=1;m>=n;n++)w[p+(n-1)]={year:a,month:e,day:n,className:a==u.Year&&e==u.Month&&n==u.Day?"active":""};for(n=m+p;42>n;n++)w[n]={year:h,month:v,day:n-m-p+1,className:"attach"};for(d=0;42>d;d++)t=w[d],s=new Date(t.year,t.month-1,t.day,f.hour,f.minute,f.second),(i>s||s>o)&&(t.className="dis"),y[d].attr({"data-year":t.year,"data-month":t.month,"class":t.className||""}).text(t.day)},b=function(a,e){return 2==e?a%400==0||a%4==0&&a%100!=0?29:28:[1,3,5,7,8,10,12].indexOf(e)>=0?31:[4,6,9,11].indexOf(e)>=0?30:void 0},g=function(){var a=new Date(f.year,f.month-1,f.day,f.hour,f.minute,f.second);i>a&&(a=i),a>o&&(a=o),M(a.Format(r))},M=function(a){l&&l(a)};v(),T(u.Year,u.Month)};return t});