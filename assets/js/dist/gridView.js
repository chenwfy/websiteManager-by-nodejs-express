!function(e,n){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(t){e.gridView=n(t)});else if("undefined"!=typeof exports){var t=require("jquery");n(t)}else e.gridView=n("undefined"!=typeof jQuery?jQuery:window.Zepto)}("undefined"!=typeof window?window:this,function(e){"use strict";return function(){var n,t,o,a,r,d,i,p,l,s,c,u,g,h,f,v,T,C,R,b,m,x;this.options=arguments[0]||{},this.dataLoader=this.options.dataLoader||{},this.dataReader=this.options.dataReader||{dataRoot:"data",pageCount:"pageCount",recordCount:"recordCount",pageSize:"pageSize",pageIndex:"pageIndex"},this.columns=this.options.columns||[],this.pageSize=~~this.options.pageSize||20,this.tableRenderTo=this.options.tableRenderTo||"",this.rowSelection="boolean"==typeof this.options.rowSelection?this.options.rowSelection:!0,this.pagerNavigation="boolean"==typeof this.options.pagerNavigation?this.options.pagerNavigation:!0,this.pagerRenderTo=this.options.pagerRenderTo||"",n=this,t={renderTo:null,table:null,thead:null,selectAll:null,tbody:null},o={renderTo:null,pagerWrapper:null,recordCountRenderTo:null,pageCountRenderTo:null,pageIndexRenderTo:null,pageRefreshSender:null,pagerNavRenderTo:null,pageSizeSelection:null},a={pageCount:1,recordCount:0,pageSize:n.pageSize,pageIndex:1},r=null,d={},i=[],this.load=function(){p(),f()},this.reload=function(){p(),a.pageIndex=1,f()},this.refresh=function(){p(),f()},this.selectedRows=function(e){var n,t,o=[];if(this.rowSelection&&i.length>0)for(n in d)t=i[d[n]],t&&(e?t[e]&&o.push(t[e]):o.push(t));return o},p=function(){l(),s(),c(),h(),g()},l=function(){if(!n.dataLoader.url)throw"\u8bf7\u6307\u5b9a\u6570\u636e\u8bf7\u6c42URL\uff01";if(n.columns.length<1)throw"\u8bf7\u6307\u8bbe\u5217\u8868\u6570\u636e\u5217\u914d\u7f6e\uff01"},s=function(){var o,a,r;t.renderTo||(o=u(n.tableRenderTo),!(o&&o.length>0)&&(o=e("<div>").addClass("wrap").appendTo(document.body)),t.renderTo=o.css("overflow","auto")),t.table||(t.thead=e("<thead>"),t.tbody=e("<tbody>"),t.table=e("<table>").addClass("listTable").attr({border:0,cellpadding:0,cellspacing:1}).append(t.thead,t.tbody).appendTo(t.renderTo)),0==t.thead.find("tr").length&&(a=e("<tr>"),r=null,n.rowSelection&&(r=e("<th>").addClass("th5").addClass("center").appendTo(a),t.selectAll=e("<input>").attr({type:"checkbox",name:"chk_tableList_checkAll"}).on("click",function(){var n=e(this).prop("checked");e(" > tr > td > input[type=checkbox][name^=chk_tableList_row_]",t.tbody).each(function(t,o){e(o).prop("checked",n);var a=parseInt(e(o).attr("value"),10);n&&(d[a.toString()]=a),!n&&d[a.toString()]&&delete d[a.toString()]})}).appendTo(r)),e.each(n.columns,function(n,t){r=e("<th>").addClass(t.className||"th5").html(t.columnName||"").appendTo(a)}),a.appendTo(t.thead))},c=function(){var t,r,d,i;n.pagerNavigation&&!o.pagerWrapper&&(t=u(n.pagerRenderTo),!(t&&t.length>0)&&(o.renderTo=document.body),o.recordCountRenderTo=e("<b>").html(0),o.pageCountRenderTo=e("<b>").html(0),o.pageIndexRenderTo=e("<b>").html(0),o.pageRefreshSender=e("<i>").addClass("icon-Awesome-refresh").addClass("dis").attr("title","\u70b9\u51fb\u5237\u65b0\u5217\u8868"),r=e("<li>").addClass("txt").append(o.recordCountRenderTo,"\u6761\u6570\u636e\u5171",o.pageCountRenderTo,"\u9875\uff0c\u5f53\u524d\u7b2c",o.pageIndexRenderTo,"\u9875",o.pageRefreshSender),o.pagerNavRenderTo=e("<li>").addClass("box"),d=e("<select>").append('<option value="5">5</option><option value="10">10</option><option value="15">15</option><option value="20" selected>20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option>').on("change",function(){a.pageSize=parseInt(e(this).val()||20,10),n.reload()}),i=e("<li>").addClass("size").append("\u6bcf\u9875\u663e\u793a",d,"\u6761"),o.pagerWrapper=e("<ul>").append(r,o.pagerNavRenderTo,i),e("<div>").addClass("paging").append(o.pagerWrapper).appendTo(o.renderTo))},u=function(n){if("string"==typeof n&&""!=n)return e("#"==n.substring(0,1)?n:"#"+n);if("object"==typeof n){if(n.ownerDocument)return e(n);if(n instanceof jQuery)return n}return null},g=function(){a.pageSize=~~a.pageSize||20,a.recordCount=~~a.recordCount||0,a.pageCount=Math.floor(a.recordCount/a.pageSize),a.recordCount%a.pageSize>0&&a.pageCount++,a.pageIndex>a.pageCount&&(a.pageIndex=a.pageCount),a.pageIndex<1&&(a.pageIndex=1)},h=function(){!r&&(r=e("<div>").addClass("loading").html("\u6570\u636e\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026").appendTo(t.renderTo).hide())},f=function(){r&&r.show();var t=n.dataLoader.data||{};t.pageSize=a.pageSize,t.pageIndex=a.pageIndex,e.ajaxPost(n.dataLoader.url,t,v)},v=function(e){m(),i=e[n.dataReader.dataRoot]||[],T(),C(e),x(),r&&r.hide()},T=function(){var a=null,r=null;i.length>0&&t.tbody.show()&&o.pageRefreshSender&&o.pageRefreshSender.removeClass("dis")&&o.pageRefreshSender.bind("click",function(){n.refresh()}),i.length<1&&t.tbody.hide()&&o.pageRefreshSender&&o.pageRefreshSender.addClass("dis")&&o.pageRefreshSender.unbind("click"),e.each(i,function(o,i){a=e("<tr>").on("click",function(){t.tbody.find("tr.active").removeClass("active"),!e(this).hasClass("active")&&e(this).addClass("active")}),n.rowSelection&&(r=e("<td>").addClass("center").appendTo(a),e("<input>").attr({type:"checkbox",name:"chk_tableList_row_"+o,value:o}).on("click",function(){var n=parseInt(e(this).attr("value"),10);e(this).prop("checked")?d[n.toString()]=n:delete d[n.toString()]}).appendTo(r)),e.each(n.columns,function(n,t){var d,p,l;if(r=e("<td>").appendTo(a),d="",t.render)switch(typeof t.render){case"string":if(d=t.render,p=d.match(/\{.*?\}/g))for(l=0;l<p.length;l++)d=d.replace(p[l],i[p[l].substring(1,p[l].length-1)]);break;case"function":d=t.render.call(i[t.dataIndex],i,o);break;case"object":d=t.render[i[t.dataIndex]]}else d=i[t.dataIndex];r.append(d)}),a.appendTo(t.tbody)})},C=function(e){a.recordCount=~~e[n.dataReader.recordCount]||0,a.pageIndex=~~e[n.dataReader.pageIndex]||1,a.pageCount=~~e[n.dataReader.pageCount]||0,n.pagerNavigation&&o.pagerWrapper&&(!!o.recordCountRenderTo&&o.recordCountRenderTo.html(a.recordCount),!!o.pageCountRenderTo&&o.pageCountRenderTo.html(a.pageCount),!!o.pageIndexRenderTo&&o.pageIndexRenderTo.html(a.pageIndex),!!o.pagerNavRenderTo&&o.pagerNavRenderTo.children().remove()&&R())},R=function(){var n,t;if(a.pageCount>1){for(a.pageIndex<=1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">Prev</a>').appendTo(o.pagerNavRenderTo),a.pageIndex>1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">Prev</a>').one("click",function(){a.pageIndex--&&f()}).appendTo(o.pagerNavRenderTo),n=[],t=1;t<a.pageIndex;t++)n.push(t);for(n.length>0&&(n.length<=3?b(n):(b([1]),e("<b>......</b>").appendTo(o.pagerNavRenderTo),n.splice(0,n.length-2),b(n))),e('<a href="javascript:void(0)" class="current">'+a.pageIndex+"</a>").appendTo(o.pagerNavRenderTo),n=[],t=a.pageIndex+1;t<=a.pageCount;t++)n.push(t);n.length>0&&(n.length<=3?b(n):(n.splice(2,n.length-2),b(n),e("<b>......</b>").appendTo(o.pagerNavRenderTo),b([a.pageCount]))),a.pageIndex>=a.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">Next</a>').appendTo(o.pagerNavRenderTo),a.pageIndex<a.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">Next</a>').one("click",function(){a.pageIndex++&&f()}).appendTo(o.pagerNavRenderTo)}},b=function(n){e.each(n,function(n,t){!function(n,t){e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u7b2c'+t+'\u9875">'+t+"</a>").one("click",function(){a.pageIndex=t,f()}).appendTo(o.pagerNavRenderTo)}(n,t)})},m=function(){!!t.tbody&&t.tbody.children().remove(),i=[],d&&(d={}),n.rowSelection&&!!t.selectAll&&t.selectAll.prop("checked",!1)},x=function(){var n=t.table[0],o=n.ownerDocument.parentWindow||n.ownerDocument.defaultView;o.onresize=function(){e(n.ownerDocument.body).width("auto"),e(n.ownerDocument.body).height("auto");var t=e(n.parentNode).height()+(e(this).height()-e(n.ownerDocument.body).outerHeight(!0));e(n.parentNode).height(t)},o.frameElement&&(o.frameElement.onresize=function(){o.onresize()},o.onunload=function(){o.frameElement?o.frameElement.onresize=function(){}:o.onresize=function(){}}),o.onresize()}}});