!function(e,n){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(o){e.gridView=n(o)});else if("undefined"!=typeof exports){var o=require("jquery");n(o)}else e.gridView=n("undefined"!=typeof jQuery?jQuery:window.Zepto)}("undefined"!=typeof window?window:this,function(e){"use strict";return function(){var n,o,t,a,r,d,i,p,l,s,c,u,g,h,f,v,T,C,R,b,m,x;this.options=arguments[0]||{},this.dataLoader=this.options.dataLoader||{},this.dataReader=this.options.dataReader||{dataRoot:"data",pageCount:"pageCount",recordCount:"recordCount",pageSize:"pageSize",pageIndex:"pageIndex"},this.columns=this.options.columns||[],this.pageSize=~~this.options.pageSize||20,this.tableRenderTo=this.options.tableRenderTo||"",this.rowSelection="boolean"==typeof this.options.rowSelection?this.options.rowSelection:!0,this.pagerNavigation="boolean"==typeof this.options.pagerNavigation?this.options.pagerNavigation:!0,this.pagerRenderTo=this.options.pagerRenderTo||"",n=this,o={renderTo:null,table:null,thead:null,selectAll:null,tbody:null},t={renderTo:null,pagerWrapper:null,recordCountRenderTo:null,pageCountRenderTo:null,pageIndexRenderTo:null,pageRefreshSender:null,pagerNavRenderTo:null,pageSizeSelection:null},a={pageCount:1,recordCount:0,pageSize:n.pageSize,pageIndex:1},r=null,d={},i=[],this.load=function(){p(),f()},this.reload=function(){p(),a.pageIndex=1,f()},this.refresh=function(){p(),f()},this.selectedRows=function(e){var n,o,t=[];if(this.rowSelection&&i.length>0)for(n in d)o=i[d[n]],o&&(e?o[e]&&t.push(o[e]):t.push(o));return t},p=function(){l(),s(),c(),h(),g()},l=function(){if(!n.dataLoader.url)throw"\u8bf7\u6307\u5b9a\u6570\u636e\u8bf7\u6c42URL\uff01";if(n.columns.length<1)throw"\u8bf7\u6307\u8bbe\u5217\u8868\u6570\u636e\u5217\u914d\u7f6e\uff01"},s=function(){var t,a,r;o.renderTo||(t=u(n.tableRenderTo),!(t&&t.length>0)&&(t=e("<div>").addClass("wrap").appendTo(document.body)),o.renderTo=t.css("overflow","auto")),o.table||(o.thead=e("<thead>"),o.tbody=e("<tbody>"),o.table=e("<table>").addClass("listTable").attr({border:0,cellpadding:0,cellspacing:1}).append(o.thead,o.tbody).appendTo(o.renderTo)),0==o.thead.find("tr").length&&(a=e("<tr>"),r=null,n.rowSelection&&(r=e("<th>").addClass("th5").addClass("center").appendTo(a),o.selectAll=e("<input>").attr({type:"checkbox",name:"chk_tableList_checkAll"}).on("click",function(){var n=e(this).prop("checked");e(" > tr > td > input[type=checkbox][name^=chk_tableList_row_]",o.tbody).each(function(o,t){e(t).prop("checked",n);var a=parseInt(e(t).attr("value"),10);n&&(d[a.toString()]=a),!n&&d[a.toString()]&&delete d[a.toString()]})}).appendTo(r)),e.each(n.columns,function(n,o){r=e("<th>").addClass(o.className||"th5").html(o.columnName||"").appendTo(a)}),a.appendTo(o.thead))},c=function(){var o,r,d,i;n.pagerNavigation&&!t.pagerWrapper&&(o=u(n.pagerRenderTo),!(o&&o.length>0)&&(t.renderTo=document.body),t.recordCountRenderTo=e("<b>").html(0),t.pageCountRenderTo=e("<b>").html(0),t.pageIndexRenderTo=e("<b>").html(0),t.pageRefreshSender=e("<i>").addClass("icon-Awesome-refresh").addClass("dis").attr("title","\u70b9\u51fb\u5237\u65b0\u5217\u8868"),r=e("<li>").addClass("txt").append(t.recordCountRenderTo,"\u6761\u6570\u636e\u5171",t.pageCountRenderTo,"\u9875\uff0c\u5f53\u524d\u7b2c",t.pageIndexRenderTo,"\u9875",t.pageRefreshSender),t.pagerNavRenderTo=e("<li>").addClass("box"),d=e("<select>").append('<option value="5">5</option><option value="10">10</option><option value="15">15</option><option value="20" selected>20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option>').on("change",function(){a.pageSize=parseInt(e(this).val()||20,10),n.reload()}),i=e("<li>").addClass("size").append("\u6bcf\u9875\u663e\u793a",d,"\u6761"),t.pagerWrapper=e("<ul>").append(r,t.pagerNavRenderTo,i),e("<div>").addClass("paging").append(t.pagerWrapper).appendTo(t.renderTo))},u=function(n){if("string"==typeof n&&""!=n)return e("#"==n.substring(0,1)?n:"#"+n);if("object"==typeof n){if(n.ownerDocument)return e(n);if(n instanceof jQuery)return n}return null},g=function(){a.pageSize=~~a.pageSize||20,a.recordCount=~~a.recordCount||0,a.pageCount=Math.floor(a.recordCount/a.pageSize),a.recordCount%a.pageSize>0&&a.pageCount++,a.pageIndex>a.pageCount&&(a.pageIndex=a.pageCount),a.pageIndex<1&&(a.pageIndex=1)},h=function(){!r&&(r=e("<div>").addClass("loading").html("\u6570\u636e\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026").appendTo(o.renderTo).hide())},f=function(){r&&r.show();var o=n.dataLoader.data||{};o.pageSize=a.pageSize,o.pageIndex=a.pageIndex,e.ajaxPost(n.dataLoader.url,o,v)},v=function(e){m(),i=e[n.dataReader.dataRoot]||[],T(),C(e),x(),r&&r.hide()},T=function(){var a=null,r=null;i.length>0&&o.tbody.show()&&t.pageRefreshSender&&t.pageRefreshSender.removeClass("dis")&&t.pageRefreshSender.one("click",function(){n.refresh()}),i.length<1&&o.tbody.hide()&&t.pageRefreshSender&&t.pageRefreshSender.addClass("dis")&&t.pageRefreshSender.unbind("click"),e.each(i,function(t,i){a=e("<tr>").on("click",function(){o.tbody.find("tr.active").removeClass("active"),!e(this).hasClass("active")&&e(this).addClass("active")}),n.rowSelection&&(r=e("<td>").addClass("center").appendTo(a),e("<input>").attr({type:"checkbox",name:"chk_tableList_row_"+t,value:t}).on("click",function(){var n=parseInt(e(this).attr("value"),10);e(this).prop("checked")?d[n.toString()]=n:delete d[n.toString()]}).appendTo(r)),e.each(n.columns,function(n,o){var d,p,l;if(r=e("<td>").appendTo(a),d="",o.render)switch(typeof o.render){case"string":if(d=o.render,p=d.match(/\{.*?\}/g))for(l=0;l<p.length;l++)d=d.replace(p[l],i[p[l].substring(1,p[l].length-1)]);break;case"function":d=o.render.call(i[o.dataIndex],i,t);break;case"object":d=o.render[i[o.dataIndex]]}else d=i[o.dataIndex];r.append(d)}),a.appendTo(o.tbody)})},C=function(e){a.recordCount=~~e[n.dataReader.recordCount]||0,a.pageIndex=~~e[n.dataReader.pageIndex]||1,a.pageCount=~~e[n.dataReader.pageCount]||0,n.pagerNavigation&&t.pagerWrapper&&(!!t.recordCountRenderTo&&t.recordCountRenderTo.html(a.recordCount),!!t.pageCountRenderTo&&t.pageCountRenderTo.html(a.pageCount),!!t.pageIndexRenderTo&&t.pageIndexRenderTo.html(a.pageIndex),!!t.pagerNavRenderTo&&t.pagerNavRenderTo.children().remove()&&R())},R=function(){var n,o;if(a.pageCount>1){for(a.pageIndex<=1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">Prev</a>').appendTo(t.pagerNavRenderTo),a.pageIndex>1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">Prev</a>').one("click",function(){a.pageIndex--&&f()}).appendTo(t.pagerNavRenderTo),n=[],o=1;o<a.pageIndex;o++)n.push(o);for(n.length>0&&(n.length<=3?b(n):(b([1]),e("<b>......</b>").appendTo(t.pagerNavRenderTo),n.splice(0,n.length-2),b(n))),e('<a href="javascript:void(0)" class="current">'+a.pageIndex+"</a>").appendTo(t.pagerNavRenderTo),n=[],o=a.pageIndex+1;o<=a.pageCount;o++)n.push(o);n.length>0&&(n.length<=3?b(n):(n.splice(2,n.length-2),b(n),e("<b>......</b>").appendTo(t.pagerNavRenderTo),b([a.pageCount]))),a.pageIndex>=a.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">Next</a>').appendTo(t.pagerNavRenderTo),a.pageIndex<a.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">Next</a>').one("click",function(){a.pageIndex++&&f()}).appendTo(t.pagerNavRenderTo)}},b=function(n){e.each(n,function(n,o){!function(n,o){e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u7b2c'+o+'\u9875">'+o+"</a>").one("click",function(){a.pageIndex=o,f()}).appendTo(t.pagerNavRenderTo)}(n,o)})},m=function(){!!o.tbody&&o.tbody.children().remove(),i=[],d&&(d={}),n.rowSelection&&!!o.selectAll&&o.selectAll.prop("checked",!1)},x=function(){var n=o.table[0],t=n.ownerDocument.parentWindow||n.ownerDocument.defaultView;t.onresize=function(){e(n.ownerDocument.body).width("auto"),e(n.ownerDocument.body).height("auto");var o=e(n.parentNode).height()+(e(this).height()-e(n.ownerDocument.body).outerHeight(!0));e(n.parentNode).height(o)},t.frameElement&&(t.frameElement.onresize=function(){t.onresize()},t.onunload=function(){t.frameElement?t.frameElement.onresize=function(){}:t.onresize=function(){}}),t.onresize()}}});