!function(e,n){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(a){e.gridView=n(a)});else if("undefined"!=typeof exports){var a=require("jquery");n(a)}else e.gridView=n("undefined"!=typeof jQuery?jQuery:window.Zepto)}("undefined"!=typeof window?window:this,function(e){"use strict";return function(){var n,a,o,t,r,d,i,p,l,c,u,s,g,h,f,v,T,C,R,b,x,m;this.options=arguments[0]||{},this.dataLoader=this.options.dataLoader||{},this.dataReader=this.options.dataReader||{dataRoot:"data",pageCount:"pageCount",recordCount:"recordCount",pageSize:"pageSize",pageIndex:"pageIndex"},this.columns=this.options.columns||[],this.pageSize=~~this.options.pageSize||20,this.tableRenderTo=this.options.tableRenderTo||"",this.rowSelection="boolean"==typeof this.options.rowSelection?this.options.rowSelection:!0,this.pagerNavigation="boolean"==typeof this.options.pagerNavigation?this.options.pagerNavigation:!0,this.pagerRenderTo=this.options.pagerRenderTo||"",n=this,a={renderTo:null,table:null,thead:null,selectAll:null,tbody:null},o={renderTo:null,pagerWrapper:null,recordCountRenderTo:null,pageCountRenderTo:null,pageIndexRenderTo:null,pageRefreshSender:null,pagerNavRenderTo:null,pageSizeSelection:null},t={pageCount:1,recordCount:0,pageSize:n.pageSize,pageIndex:1},r=null,d={},i=[],this.drawTable=function(){p(),n.pagerNavigation&&m()},this.load=function(){p(),f()},this.reload=function(){p(),t.pageIndex=1,f()},this.refresh=function(){p(),f()},this.selectedRows=function(e){var n,a,o=[];if(this.rowSelection&&i.length>0)for(n in d)a=i[d[n]],a&&(e?a[e]&&o.push(a[e]):o.push(a));return o},p=function(){l(),c(),u(),h(),g()},l=function(){if(!n.dataLoader.url)throw"\u8bf7\u6307\u5b9a\u6570\u636e\u8bf7\u6c42URL\uff01";if(n.columns.length<1)throw"\u8bf7\u6307\u8bbe\u5217\u8868\u6570\u636e\u5217\u914d\u7f6e\uff01"},c=function(){var o,t,r;a.renderTo||(o=s(n.tableRenderTo),!(o&&o.length>0)&&(o=e("<div>").addClass("wrap").appendTo(document.body)),a.renderTo=o.css("overflow","auto")),a.table||(a.thead=e("<thead>"),a.tbody=e("<tbody>"),a.table=e("<table>").addClass("listTable").attr({border:0,cellpadding:0,cellspacing:1}).append(a.thead,a.tbody).appendTo(a.renderTo)),0==a.thead.find("tr").length&&(t=e("<tr>"),r=null,n.rowSelection&&(r=e("<th>").addClass("th5").addClass("center").appendTo(t),a.selectAll=e("<input>").attr({type:"checkbox",name:"chk_tableList_checkAll"}).on("click",function(){var n=e(this).prop("checked");e(" > tr > td > input[type=checkbox][name^=chk_tableList_row_]",a.tbody).each(function(a,o){e(o).prop("checked",n);var t=parseInt(e(o).attr("value"),10);n&&(d[t.toString()]=t),!n&&d[t.toString()]&&delete d[t.toString()]})}).appendTo(r)),e.each(n.columns,function(n,a){r=e("<th>").addClass(a.className||"th5").html(a.columnName||"").appendTo(t)}),t.appendTo(a.thead))},u=function(){var a,r,d,i;n.pagerNavigation&&!o.pagerWrapper&&(a=s(n.pagerRenderTo),!(a&&a.length>0)&&(o.renderTo=document.body),o.recordCountRenderTo=e("<b>").html(0),o.pageCountRenderTo=e("<b>").html(0),o.pageIndexRenderTo=e("<b>").html(0),o.pageRefreshSender=e("<i>").addClass("icon-Awesome-refresh").addClass("dis").attr("title","\u70b9\u51fb\u5237\u65b0\u5217\u8868"),r=e("<li>").addClass("txt").append(o.recordCountRenderTo,"\u6761\u6570\u636e\u5171",o.pageCountRenderTo,"\u9875\uff0c\u5f53\u524d\u7b2c",o.pageIndexRenderTo,"\u9875",o.pageRefreshSender),o.pagerNavRenderTo=e("<li>").addClass("box"),d=e("<select>").append('<option value="5">5</option><option value="10">10</option><option value="15">15</option><option value="20" selected>20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option>').on("change",function(){t.pageSize=parseInt(e(this).val()||20,10),n.reload()}),i=e("<li>").addClass("size").append("\u6bcf\u9875\u663e\u793a",d,"\u6761"),o.pagerWrapper=e("<ul>").append(r,o.pagerNavRenderTo,i),e("<div>").addClass("paging").append(o.pagerWrapper).appendTo(o.renderTo))},s=function(n){if("string"==typeof n&&""!=n)return e("#"==n.substring(0,1)?n:"#"+n);if("object"==typeof n){if(n.ownerDocument)return e(n);if(n instanceof jQuery)return n}return null},g=function(){t.pageSize=~~t.pageSize||20,t.recordCount=~~t.recordCount||0,t.pageCount=Math.floor(t.recordCount/t.pageSize),t.recordCount%t.pageSize>0&&t.pageCount++,t.pageIndex>t.pageCount&&(t.pageIndex=t.pageCount),t.pageIndex<1&&(t.pageIndex=1)},h=function(){!r&&(r=e("<div>").addClass("loading").html("\u6570\u636e\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026").appendTo(a.renderTo).hide())},f=function(){r&&r.show();var a=n.dataLoader.data||{};a.pageSize=t.pageSize,a.pageIndex=t.pageIndex,e.ajaxPost(n.dataLoader.url,a,v)},v=function(e){x(),i=e[n.dataReader.dataRoot]||[],T(),C(e),n.pagerNavigation&&m(),r&&r.hide(),0==i.length&&t.recordCount>0&&t.pageIndex>=t.pageCount&&(t.pageIndex>1&&t.pageIndex--,f())},T=function(){var t=null,r=null;i.length>0&&a.tbody.show()&&o.pageRefreshSender&&o.pageRefreshSender.removeClass("dis")&&o.pageRefreshSender.one("click",function(){n.refresh()}),i.length<1&&a.tbody.hide()&&o.pageRefreshSender&&o.pageRefreshSender.addClass("dis")&&o.pageRefreshSender.unbind("click"),e.each(i,function(o,i){t=e("<tr>").on("click",function(){a.tbody.find("tr.active").removeClass("active"),!e(this).hasClass("active")&&e(this).addClass("active")}),n.rowSelection&&(r=e("<td>").addClass("center").appendTo(t),e("<input>").attr({type:"checkbox",name:"chk_tableList_row_"+o,value:o}).on("click",function(){var n=parseInt(e(this).attr("value"),10);e(this).prop("checked")?d[n.toString()]=n:delete d[n.toString()]}).appendTo(r)),e.each(n.columns,function(n,a){var d,p,l;if(r=e("<td>").appendTo(t),d="",a.render)switch(typeof a.render){case"string":if(d=a.render,p=d.match(/\{.*?\}/g))for(l=0;l<p.length;l++)d=d.replace(p[l],i[p[l].substring(1,p[l].length-1)]);break;case"function":d=a.render.call(i[a.dataIndex],i,o);break;case"object":d=a.render[i[a.dataIndex]]}else d=i[a.dataIndex];r.append(d)}),t.appendTo(a.tbody)})},C=function(e){t.recordCount=~~e[n.dataReader.recordCount]||0,t.pageIndex=~~e[n.dataReader.pageIndex]||1,t.pageCount=~~e[n.dataReader.pageCount]||0,t.pageIndex>=t.pageCount&&(t.pageIndex=t.pageCount),t.pageIndex<1&&(t.pageIndex=1),n.pagerNavigation&&o.pagerWrapper&&(!!o.recordCountRenderTo&&o.recordCountRenderTo.html(t.recordCount),!!o.pageCountRenderTo&&o.pageCountRenderTo.html(t.pageCount),!!o.pageIndexRenderTo&&o.pageIndexRenderTo.html(t.pageIndex),!!o.pagerNavRenderTo&&o.pagerNavRenderTo.children().remove()&&R())},R=function(){var n,a;if(t.pageCount>=1&&t.recordCount>0){for(t.pageIndex<=1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">\u4e0a\u4e00\u9875</a>').appendTo(o.pagerNavRenderTo),t.pageIndex>1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">\u4e0a\u4e00\u9875</a>').one("click",function(){t.pageIndex--&&f()}).appendTo(o.pagerNavRenderTo),n=[],a=1;a<t.pageIndex;a++)n.push(a);for(n.length>0&&(n.length<=3?b(n):(b([1]),e("<b>......</b>").appendTo(o.pagerNavRenderTo),n.splice(0,n.length-2),b(n))),e('<a href="javascript:void(0)" class="current">'+t.pageIndex+"</a>").appendTo(o.pagerNavRenderTo),n=[],a=t.pageIndex+1;a<=t.pageCount;a++)n.push(a);n.length>0&&(n.length<=3?b(n):(n.splice(2,n.length-2),b(n),e("<b>......</b>").appendTo(o.pagerNavRenderTo),b([t.pageCount]))),t.pageIndex>=t.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">\u4e0b\u4e00\u9875</a>').appendTo(o.pagerNavRenderTo),t.pageIndex<t.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">\u4e0b\u4e00\u9875</a>').one("click",function(){t.pageIndex++&&f()}).appendTo(o.pagerNavRenderTo)}},b=function(n){e.each(n,function(n,a){!function(n,a){e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u7b2c'+a+'\u9875">'+a+"</a>").one("click",function(){t.pageIndex=a,f()}).appendTo(o.pagerNavRenderTo)}(n,a)})},x=function(){!!a.tbody&&a.tbody.children().remove(),i=[],d&&(d={}),n.rowSelection&&!!a.selectAll&&a.selectAll.prop("checked",!1)},m=function(){var n=a.table[0],o=n.ownerDocument.parentWindow||n.ownerDocument.defaultView;o.onresize=function(){e(n.ownerDocument.body).width("auto"),e(n.ownerDocument.body).height("auto");var a=e(n.parentNode).height()+(e(this).height()-e(n.ownerDocument.body).outerHeight(!0));e(n.parentNode).height(a)},o.frameElement&&(o.frameElement.onresize=function(){o.onresize()},o.onunload=function(){o.frameElement?o.frameElement.onresize=function(){}:o.onresize=function(){}}),o.onresize()}}});