!function(e,n){"use strict";if("function"==typeof define&&define.amd)define(["jquery"],function(o){e.gridView=n(o)});else if("undefined"!=typeof exports){var o=require("jquery");n(o)}else e.gridView=n("undefined"!=typeof jQuery?jQuery:window.Zepto)}("undefined"!=typeof window?window:this,function(e){"use strict";return function(){var n,o,a,t,r,d,i,p,l,c,s,u,g,h,f,v,T,C,R,b,x,m;this.options=arguments[0]||{},this.dataLoader=this.options.dataLoader||{},this.dataReader=this.options.dataReader||{dataRoot:"data",pageCount:"pageCount",recordCount:"recordCount",pageSize:"pageSize",pageIndex:"pageIndex"},this.columns=this.options.columns||[],this.pageSize=~~this.options.pageSize||20,this.tableRenderTo=this.options.tableRenderTo||"",this.rowSelection="boolean"==typeof this.options.rowSelection?this.options.rowSelection:!0,this.pagerNavigation="boolean"==typeof this.options.pagerNavigation?this.options.pagerNavigation:!0,this.pagerRenderTo=this.options.pagerRenderTo||"",n=this,o={renderTo:null,table:null,thead:null,selectAll:null,tbody:null},a={renderTo:null,pagerWrapper:null,recordCountRenderTo:null,pageCountRenderTo:null,pageIndexRenderTo:null,pageRefreshSender:null,pagerNavRenderTo:null,pageSizeSelection:null},t={pageCount:1,recordCount:0,pageSize:n.pageSize,pageIndex:1},r=null,d={},i=[],this.drawTable=function(){p(),n.pagerNavigation&&m()},this.load=function(){p(),f()},this.reload=function(){p(),t.pageIndex=1,f()},this.refresh=function(){p(),f()},this.selectedRows=function(e){var n,o,a=[];if(this.rowSelection&&i.length>0)for(n in d)o=i[d[n]],o&&(e?o[e]&&a.push(o[e]):a.push(o));return a},p=function(){l(),c(),s(),h(),g()},l=function(){if(!n.dataLoader.url)throw"\u8bf7\u6307\u5b9a\u6570\u636e\u8bf7\u6c42URL\uff01";if(n.columns.length<1)throw"\u8bf7\u6307\u8bbe\u5217\u8868\u6570\u636e\u5217\u914d\u7f6e\uff01"},c=function(){var a,t,r;o.renderTo||(a=u(n.tableRenderTo),!(a&&a.length>0)&&(a=e("<div>").addClass("wrap").appendTo(document.body)),o.renderTo=a.css("overflow","auto")),o.table||(o.thead=e("<thead>"),o.tbody=e("<tbody>"),o.table=e("<table>").addClass("listTable").attr({border:0,cellpadding:0,cellspacing:1}).append(o.thead,o.tbody).appendTo(o.renderTo)),0==o.thead.find("tr").length&&(t=e("<tr>"),r=null,n.rowSelection&&(r=e("<th>").addClass("th5").addClass("center").appendTo(t),o.selectAll=e("<input>").attr({type:"checkbox",name:"chk_tableList_checkAll"}).on("click",function(){var n=e(this).prop("checked");e(" > tr > td > input[type=checkbox][name^=chk_tableList_row_]",o.tbody).each(function(o,a){e(a).prop("checked",n);var t=parseInt(e(a).attr("value"),10);n&&(d[t.toString()]=t),!n&&d[t.toString()]&&delete d[t.toString()]})}).appendTo(r)),e.each(n.columns,function(n,o){r=e("<th>").addClass(o.className||"th5").html(o.columnName||"").appendTo(t)}),t.appendTo(o.thead))},s=function(){var o,r,d,i;n.pagerNavigation&&!a.pagerWrapper&&(o=u(n.pagerRenderTo),!(o&&o.length>0)&&(a.renderTo=document.body),a.recordCountRenderTo=e("<b>").html(0),a.pageCountRenderTo=e("<b>").html(0),a.pageIndexRenderTo=e("<b>").html(0),a.pageRefreshSender=e("<i>").addClass("icon-Awesome-refresh").addClass("dis").attr("title","\u70b9\u51fb\u5237\u65b0\u5217\u8868"),r=e("<li>").addClass("txt").append(a.recordCountRenderTo,"\u6761\u6570\u636e\u5171",a.pageCountRenderTo,"\u9875\uff0c\u5f53\u524d\u7b2c",a.pageIndexRenderTo,"\u9875",a.pageRefreshSender),a.pagerNavRenderTo=e("<li>").addClass("box"),d=e("<select>").append('<option value="5">5</option><option value="10">10</option><option value="15">15</option><option value="20" selected>20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option>').on("change",function(){t.pageSize=parseInt(e(this).val()||20,10),n.reload()}),i=e("<li>").addClass("size").append("\u6bcf\u9875\u663e\u793a",d,"\u6761"),a.pagerWrapper=e("<ul>").append(r,a.pagerNavRenderTo,i),e("<div>").addClass("paging").append(a.pagerWrapper).appendTo(a.renderTo))},u=function(n){if("string"==typeof n&&""!=n)return e("#"==n.substring(0,1)?n:"#"+n);if("object"==typeof n){if(n.ownerDocument)return e(n);if(n instanceof jQuery)return n}return null},g=function(){t.pageSize=~~t.pageSize||20,t.recordCount=~~t.recordCount||0,t.pageCount=Math.floor(t.recordCount/t.pageSize),t.recordCount%t.pageSize>0&&t.pageCount++,t.pageIndex>t.pageCount&&(t.pageIndex=t.pageCount),t.pageIndex<1&&(t.pageIndex=1)},h=function(){!r&&(r=e("<div>").addClass("loading").html("\u6570\u636e\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019\u2026\u2026").appendTo(o.renderTo).hide())},f=function(){r&&r.show();var o=n.dataLoader.data||{};o.pageSize=t.pageSize,o.pageIndex=t.pageIndex,e.ajaxPost(n.dataLoader.url,o,v)},v=function(e){x(),i=e[n.dataReader.dataRoot]||[],T(),C(e),n.pagerNavigation&&m(),r&&r.hide(),0==i.length&&t.recordCount>0&&t.pageIndex>=t.pageCount&&(t.pageIndex>1&&t.pageIndex--,f())},T=function(){var t=null,r=null;i.length>0&&o.tbody.show()&&a.pageRefreshSender&&a.pageRefreshSender.removeClass("dis")&&a.pageRefreshSender.off("click")&&a.pageRefreshSender.one("click",function(){n.refresh()}),i.length<1&&o.tbody.hide()&&a.pageRefreshSender&&a.pageRefreshSender.addClass("dis")&&a.pageRefreshSender.off("click"),e.each(i,function(a,i){t=e("<tr>").on("click",function(){o.tbody.find("tr.active").removeClass("active"),!e(this).hasClass("active")&&e(this).addClass("active")}),n.rowSelection&&(r=e("<td>").addClass("center").appendTo(t),e("<input>").attr({type:"checkbox",name:"chk_tableList_row_"+a,value:a}).on("click",function(){var n=parseInt(e(this).attr("value"),10);e(this).prop("checked")?d[n.toString()]=n:delete d[n.toString()]}).appendTo(r)),e.each(n.columns,function(n,o){var d,p,l;if(r=e("<td>").appendTo(t),d="",o.render)switch(typeof o.render){case"string":if(d=o.render,p=d.match(/\{.*?\}/g))for(l=0;l<p.length;l++)d=d.replace(p[l],i[p[l].substring(1,p[l].length-1)]);break;case"function":d=o.render.call(i[o.dataIndex],i,a);break;case"object":d=o.render[i[o.dataIndex]]}else d=i[o.dataIndex];r.append(d)}),t.appendTo(o.tbody)})},C=function(e){t.recordCount=~~e[n.dataReader.recordCount]||0,t.pageIndex=~~e[n.dataReader.pageIndex]||1,t.pageCount=~~e[n.dataReader.pageCount]||0,t.pageIndex>=t.pageCount&&(t.pageIndex=t.pageCount),t.pageIndex<1&&(t.pageIndex=1),n.pagerNavigation&&a.pagerWrapper&&(!!a.recordCountRenderTo&&a.recordCountRenderTo.html(t.recordCount),!!a.pageCountRenderTo&&a.pageCountRenderTo.html(t.pageCount),!!a.pageIndexRenderTo&&a.pageIndexRenderTo.html(t.pageIndex),!!a.pagerNavRenderTo&&a.pagerNavRenderTo.children().remove()&&R())},R=function(){var n,o;if(t.pageCount>=1&&t.recordCount>0){for(t.pageIndex<=1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">\u4e0a\u4e00\u9875</a>').appendTo(a.pagerNavRenderTo),t.pageIndex>1&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0a\u4e00\u9875">\u4e0a\u4e00\u9875</a>').one("click",function(){t.pageIndex--&&f()}).appendTo(a.pagerNavRenderTo),n=[],o=1;o<t.pageIndex;o++)n.push(o);for(n.length>0&&(n.length<=3?b(n):(b([1]),e("<b>......</b>").appendTo(a.pagerNavRenderTo),n.splice(0,n.length-2),b(n))),e('<a href="javascript:void(0)" class="current">'+t.pageIndex+"</a>").appendTo(a.pagerNavRenderTo),n=[],o=t.pageIndex+1;o<=t.pageCount;o++)n.push(o);n.length>0&&(n.length<=3?b(n):(n.splice(2,n.length-2),b(n),e("<b>......</b>").appendTo(a.pagerNavRenderTo),b([t.pageCount]))),t.pageIndex>=t.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">\u4e0b\u4e00\u9875</a>').appendTo(a.pagerNavRenderTo),t.pageIndex<t.pageCount&&e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u4e0b\u4e00\u9875">\u4e0b\u4e00\u9875</a>').one("click",function(){t.pageIndex++&&f()}).appendTo(a.pagerNavRenderTo)}},b=function(n){e.each(n,function(n,o){!function(n,o){e('<a href="javascript:void(0);" title="\u8f6c\u81f3\u7b2c'+o+'\u9875">'+o+"</a>").one("click",function(){t.pageIndex=o,f()}).appendTo(a.pagerNavRenderTo)}(n,o)})},x=function(){!!o.tbody&&o.tbody.children().remove(),i=[],d&&(d={}),n.rowSelection&&!!o.selectAll&&o.selectAll.prop("checked",!1)},m=function(){var n=o.table[0],a=n.ownerDocument.parentWindow||n.ownerDocument.defaultView;a.onresize=function(){e(n.ownerDocument.body).width("auto"),e(n.ownerDocument.body).height("auto");var o=e(n.parentNode).height()+(e(this).height()-e(n.ownerDocument.body).outerHeight(!0));e(n.parentNode).height(o)},a.frameElement&&(a.frameElement.onresize=function(){a.onresize()},a.onunload=function(){a.frameElement?a.frameElement.onresize=function(){}:a.onresize=function(){}}),a.onresize()}}});